<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>CV - {{ data.personal_info.name | default('Candidat') }}</title>
  <style>
    /* VARIABLES/ACCENT */
    :root {
      --primary-color: #1F2937; /* Gris très foncé (presque noir) */
      --secondary-color: #374151; /* Gris foncé (pour les titres) */
      --accent-color: #1E3A8A; /* Bleu foncé */
      --text-subtle: #6B7280; /* Gris moyen pour les dates/détails */
    }

    /* BASE */
    body {
      font-family: 'Times New Roman', Times, serif; 
      margin: 40px;
      font-size: 11pt;
      color: var(--primary-color);
      line-height: 1.4;
    }
    a {
      color: var(--accent-color);
      font-size: 10pt;
      text-decoration: none;
    }

    /* TYPOGRAPHIE */
    h1 { 
      font-size: 24pt; 
      margin: 0; 
      color: var(--primary-color);
      font-weight: bold;
    }
    h2 {
      font-size: 14pt;
      margin-top: 24px; /* Plus d'espace pour la séparation */
      margin-bottom: 6px;
      padding-bottom: 3px;
      border-bottom: 1px solid var(--text-subtle); /* Ligne de séparation subtile */
      color: var(--secondary-color);
      font-weight: bold;
      text-transform: uppercase;
    }
    h3 {
      font-size: 11pt;
      margin: 10px 0 2px 0;
      color: var(--primary-color);
      font-weight: bold;
    }

    /* LISTES & BLOCS */
    ul { 
      padding-left: 20px; 
      margin: 4px 0 10px 0; 
      list-style-type: disc;
    }
    li { 
      margin-bottom: 4px; 
      font-size: 10pt;
    }
    p { margin: 2px 0; font-size: 10pt; }
    
    /* DIVERS */
    .subtle {
      font-size: 9pt;
      color: var(--text-subtle);
    }
    .date-range {
      font-style: italic;
      color: var(--text-subtle);
      font-size: 9pt;
      margin-top: 0;
    }
    .contact-info {
        font-size: 10pt;
        color: var(--secondary-color);
        margin-top: 6px;
    }
    .detail-list {
        margin: 0;
        padding-left: 15px;
    }
  </style>
</head>
<body>


<table style="width: 100%; margin-bottom: 16px;">
  <tr>
    <td style="width: auto; vertical-align: top;">
      <h1 style="font-size: 22pt; margin: 0;">{{ data.personal_info.name | upper }}</h1>
      <div class="contact-info">
        <p>
          {% if data.personal_info.phone %}
            <strong>Tél:</strong> {{ data.personal_info.phone }} | 
          {% endif %}
          {% if data.personal_info.email %}
            <a href="mailto:{{ data.personal_info.email }}">{{ data.personal_info.email }}</a>
          {% endif %}
        </p>
        {% if data.personal_info.linkedin %}
          <p><a href="{{ data.personal_info.linkedin }}">LinkedIn</a></p>
        {% endif %}
      </div>
    </td>
    {% if data.personal_info.photo_path %}
    <td style="width: 95px; text-align: right; vertical-align: top;">
      <img src="{{ data.personal_info.photo_path }}" style="width: 90px; height: 90px; border-radius: 8px; border: 1px solid #ccc; object-fit: cover; box-shadow: 1px 1px 3px rgba(0,0,0,0.1);">
    </td>
    {% endif %}
  </tr>
</table>

{% if data.experiences %}
<h2>Expériences Professionnelles</h2>
{% for exp in data.experiences | reverse %}
  <h3>{{ exp.title }} <span style="font-weight: normal;">chez {{ exp.company }}</span></h3>
  <p class="date-range">{{ exp.type }} | {{ exp.start_date }} {% if exp.current %}– Aujourd’hui{% else %}– {{ exp.end_date }}{% endif %} | {{ exp.location }}</p>
  <ul class="detail-list">
    {% for task in exp.description.split('\n') %}
      {% if task.strip() %}<li>{{ task.strip() | replace('-', '') }}</li>{% endif %}
    {% endfor %}
  </ul>
  {% if exp.ref_name %}
  <p class="subtle">Référence : {{ exp.ref_name }} — {{ exp.ref_contact }}</p>
  {% endif %}
{% endfor %}
{% endif %}

---
{% if data.education %}
<h2>Formation</h2>
{% for edu in data.education | reverse %}
  <h3>{{ edu.degree }} <span style="font-weight: normal;">@ {{ edu.school }}</span></h3>
  <p class="date-range">{{ edu.start_year }} {% if edu.in_progress %}– En cours{% else %}– {{ edu.end_year }}{% endif %}</p>
  
  {% if edu.courses | select('length') | list %}
  <p style="margin-top: 5px; margin-bottom: 2px; font-size: 10pt;">**Matières/Cours principaux :**</p>
  <ul style="list-style-type: circle; margin-top: 0;">
    {% for course in edu.courses %}
      {% if course %}<li>{{ course }}</li>{% endif %}
    {% endfor %}
  </ul>
  {% endif %}
  
  {% if edu.thesis_subject %}
  <p style="margin: 5px 0 0 0; font-size: 10pt;">**Mémoire/Thèse :** {{ edu.thesis_subject }}</p>
  <p class="subtle">Encadrant(s) : {{ edu.thesis_supervisors }}</p>
  {% endif %}
{% endfor %}
{% endif %}

---
{% if data.skills or data.languages %}
<h2>Compétences & Langues</h2>
{% endif %}

{% if data.skills %}
<p style="margin-top: 8px; font-weight: bold; font-size: 10pt;">Compétences Techniques :</p>
<p style="margin-bottom: 10px; font-size: 10pt;">
  {% for skill in data.skills %}
  <span style="font-weight: normal;">{{ skill }}</span>{% if not loop.last %}, {% endif %}
  {% endfor %}
</p>
{% endif %}

{% if data.languages %}
<p style="margin-top: 8px; font-weight: bold; font-size: 10pt;">Langues :</p>
<p style="margin-bottom: 10px; font-size: 10pt;">
  {% for lang in data.languages %}
  <span style="font-weight: bold;">{{ lang.name }}</span> :
  {% set levels = [] %}
  {% if lang.speak %}{% set levels = levels + ['Parlé'] %}{% endif %}
  {% if lang.read %}{% set levels = levels + ['Lu'] %}{% endif %}
  {% if lang.write %}{% set levels = levels + ['Écrit'] %}{% endif %}
  {{ levels | join(', ') }}{% if not loop.last %}; {% endif %}
  {% endfor %}
</p>
{% endif %}

---
{% if data.distinctions %}
<h2>Projets & Distinctions</h2>
<ul class="detail-list">
  {% for item in data.distinctions %}
  <li style="font-size: 10pt;">
    <span style="font-weight: bold;">{{ item.title }}</span> ({{ item.year }}) - 
    <span class="subtle">{{ item.type }}</span>
    {% if item.description %}: {{ item.description }}{% endif %}
  </li>
  {% endfor %}
</ul>
{% endif %}

---
{% if data.certifications %}
<h2>Certifications</h2>
<ul class="detail-list">
  {% for cert in data.certifications %}
  <li>
    <span style="font-weight: bold;">{{ cert.title }}</span> – {{ cert.issuer }}{% if cert.year %} ({{ cert.year }}){% endif %}
    {% if cert.url %}
    <span class="subtle"> | Lien: <a href="{{ cert.url }}">{{ cert.url | truncate(30, True, '...') }}</a></span>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endif %}

<footer style="font-size: 8pt; text-align: center; color: #aaa; margin-top: 40px;">
  CV généré automatiquement - {{ data.personal_info.name }} le {{ today | default('Date') }}
</footer>

</body>
</html>