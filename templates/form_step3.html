{% extends "base.html" %}

{% block title %}√âtape 3 - Comp√©tences{% endblock %}

{% block content %}
    <div class="w-full max-w-2xl mx-auto space-y-8">
      
      <h1 class="text-3xl font-extrabold text-gray-900 border-b pb-4 text-center">
          <span class="text-blue-600">üõ†Ô∏è</span> √âtape 3 : Comp√©tences
      </h1>
      
      <p class="text-gray-600 text-center">Ajoutez vos comp√©tences techniques, linguistiques et autres points forts. Vous pouvez √©galement pr√©ciser votre niveau (Ex: Python - Expert).</p>

      <form method="POST" id="skillsForm" class="space-y-6">
        
        <div id="skillsFields" class="space-y-4 bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-inner">
          <label class="font-semibold block mb-3 text-gray-800">Liste des comp√©tences :</label>
          
          {% for skill in skills %}
          <div class="skillEntry flex items-center space-x-3">
              <input type="text" name="skills[]" value="{{ skill | default('') }}" placeholder="Ex: JavaScript, Docker, Gestion de projet..." required 
                     class="flex-1 border p-2 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
              
              {% if loop.length > 1 %}
              <button type="button" onclick="removeSkill(this)" class="text-red-500 hover:text-red-700 p-2 rounded-full transition bg-white shadow-sm" aria-label="Supprimer cette comp√©tence">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
              </button>
              {% endif %}
          </div>
          {% endfor %}

          {% if not skills %}
          <div class="skillEntry flex items-center space-x-3">
              <input type="text" name="skills[]" placeholder="Ex: Microsoft Azure, Anglais - C1" required 
                     class="flex-1 border p-2 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
          </div>
          {% endif %}
        </div>

        <button type="button" onclick="addSkill()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition shadow-md font-medium">
          + Ajouter une comp√©tence
        </button>

        <div class="mt-6 border-t pt-6">
          <button type="submit" class="w-full bg-green-600 text-white font-bold text-lg py-3 rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
            Suivant ‚è©
          </button>
        </div>
      </form>
    </div>

<script>
/**
 * Ajoute un nouveau champ de comp√©tence vide.
 */
function addSkill() {
  const container = document.getElementById("skillsFields");
  const div = document.createElement("div");
  
  div.className = "skillEntry flex items-center space-x-3";
  div.innerHTML = `
    <input type="text" name="skills[]" placeholder="Ex: Comp√©tence technique, soft skill..." required 
           class="flex-1 border p-2 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
    <button type="button" onclick="removeSkill(this)" class="text-red-500 hover:text-red-700 p-2 rounded-full transition bg-white shadow-sm" aria-label="Supprimer cette comp√©tence">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
    </button>
  `;
  container.appendChild(div);
  
  // S'assurer que le bouton de suppression appara√Æt sur les autres entr√©es
  toggleRemoveButtons();
}

/**
 * Supprime le champ de comp√©tence associ√© au bouton cliqu√©.
 * @param {HTMLButtonElement} button - Le bouton de suppression.
 */
function removeSkill(button) {
  const entry = button.closest('.skillEntry');
  if (entry) {
    entry.remove();
    // Re-√©value l'affichage des boutons de suppression
    toggleRemoveButtons();
  }
}

/**
 * G√®re l'affichage des boutons de suppression (masqu√© s'il n'y a qu'une seule entr√©e).
 */
function toggleRemoveButtons() {
    const entries = document.querySelectorAll('.skillEntry');
    const removeButtons = document.querySelectorAll('.skillEntry button[onclick="removeSkill(this)"]');
    
    // Si la page contient une seule entr√©e (ou moins), on cache tous les boutons de suppression.
    if (entries.length <= 1) {
        removeButtons.forEach(btn => btn.style.display = 'none');
    } else {
        removeButtons.forEach(btn => btn.style.display = 'block');
    }
}

// Initialisation au chargement : g√©rer l'affichage des boutons de suppression
document.addEventListener('DOMContentLoaded', toggleRemoveButtons);
</script>
{% endblock %}